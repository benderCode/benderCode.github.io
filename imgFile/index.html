<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ImgFile-文件处理</title>
    <link rel="stylesheet" href="../css/reset.css">
    <script src="../js/JQuery.1.12.4.min.js"></script>
    <style>
        .container {
            height: 50vh;
            margin: 0 auto;
            background: #dddddd;
            overflow-y: scroll;
        }

        .fileBtnContent {
            position: relative;
            height: 35px;
            line-height: 35px;
            background: purple;
            border-radius: 8px;
        }

        .fileBtn {
            display: block;
            font-size: 12px;
            color: #ffffff;
            text-align: center;
        }

        .fileInput {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
        }

        .imgItem {
            display: inline-block;
            width: 80px;
            height: 120px;
            margin: 10px;
        }

        .imgItem>img {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
    <script>
        $(function () {
            // 上传图片 - start
            $(".fileInput0").change(function () {
                var imgArr = [];// 存放数据数组
                var uploadFile = $(this)[0].files;// 选择的图片资源 

                var fileIndex = 0;// 循环的索引

                // file对象 uploadFile[fileIndex]
                // name:"logo.png" // 文件名
                // size:27268   // 大小KB
                // type:"image/png" // 类型

                // new FileReader() 对象 获取图片的 base64 
                var reader = new FileReader();

                reader.readAsDataURL(uploadFile[fileIndex]);

                // new FileReader() 对象读取完成方法 onload
                reader.onload = function (e) {

                    // e.target.result 读取到的 base64 
                    if (e.target.result) {

                        // 文件类型校验
                        if (/(.png|.jpg|.jpeg)$/gi.test(uploadFile[fileIndex].name)) {
                            // 符合校验操作
                            imgArr.push({
                                name: uploadFile[fileIndex].name,
                                size: uploadFile[fileIndex].size,
                                type: uploadFile[fileIndex].type,
                                base64: e.target.result,
                            })
                        } else {
                            // 不符合校验操作
                        }

                        // 增加索引
                        fileIndex++;
                        if (fileIndex < uploadFile.length) {
                            reader.readAsDataURL(uploadFile[fileIndex]);
                        } else {
                            // 循环完毕
                            // 组装整理后的资源
                            var _html = "";
                            for (var i = 0; i < imgArr.length; i++) {
                                _html += '<li class="imgItem">\
                                    <img src="'+ imgArr[i].base64 + '" alt="' + imgArr[i].name + '">\
                                </li>';
                            }
                            $(".base64Img").html(_html);
                        }
                    }
                }
            })

            //获取预览图片路径
            var getObjectURL = function (file) {
                var url = null;
                if (window.createObjectURL != undefined) { // basic
                    url = window.createObjectURL(file);
                } else if (window.URL != undefined) { // mozilla(firefox)
                    url = window.URL.createObjectURL(file);
                } else if (window.webkitURL != undefined) { // webkit or chrome
                    url = window.webkitURL.createObjectURL(file);
                }
                return url;
            }
            $(".fileInput1").change(function () {
                var files = $(this)[0].files;
                var _blobHtml = "";
                for (var i = 0; i < files.length; i++) {
                    _blobHtml += '<li class="imgItem">\
                        <img src="'+ getObjectURL(files[i]) + '" alt="">\
                    </li>'
                }
                $(".blobImg").html(_blobHtml);
            })
        })
    </script>
</head>

<body>
    <div class="container">
        <!-- 上传按钮 - start -->
        <div class="fileBtnContent">
            <a class="fileBtn" href="javascript:;">选择文件(base64渲染图片)</a>
            <input class="fileInput fileInput0" type="file" multiple="multiple">
        </div>
        <!-- 上传按钮 - end -->
        <!-- 盛放图片的容器 - start -->
        <ul class="imgUl base64Img">
            <!-- <li class="imgItem">
                <img src="" alt="">
            </li> -->
        </ul>
        <!-- 盛放图片的容器 - end -->
    </div>
    <div class="container">
        <!-- 上传按钮 - start -->
        <div class="fileBtnContent">
            <a class="fileBtn" href="javascript:;">选择文件(本地文件路径读取图片)</a>
            <input class="fileInput fileInput1" type="file" multiple="multiple">
        </div>
        <!-- 上传按钮 - end -->
        <!-- 盛放图片的容器 - start -->
        <ul class="imgUl blobImg">
            <!-- <li class="imgItem">
                    <img src="" alt="">
                </li> -->
        </ul>
        <!-- 盛放图片的容器 - end -->
    </div>
</body>

</html>